using System;
using System.Collections.Generic;
using System.Linq;

class Program
{
    static void Main()
    {
        // Example data
        Dictionary<string, Dictionary<string, int>> data = new Dictionary<string, Dictionary<string, int>>()
        {
            {"row1", new Dictionary<string, int> { {"key1", 3}, {"key2", 5} }},
            {"row2", new Dictionary<string, int> { {"key1", 4}, {"key3", 6} }}
        };

        // Flatten the dictionary and group by key
        var combined = data.SelectMany(row => row.Value)
                           .GroupBy(kvp => kvp.Key)
                           .ToDictionary(group => group.Key, group => group.Average(kvp => kvp.Value));

        // Print averages
        foreach (var kvp in combined)
        {
            Console.WriteLine($"Key: {kvp.Key}, Average: {kvp.Value}");
        }
    }
}
