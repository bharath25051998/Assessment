SELECT 
    ChapterID,
    CASE
        WHEN NOT EXISTS (SELECT 1 FROM ChapterApproval c2 WHERE c2.ChapterID = c.ChapterID) THEN 'Not yet submitted'
        WHEN EXISTS (SELECT 1 FROM ChapterApproval c2 WHERE c2.ChapterID = c.ChapterID AND c2.Status = 2) THEN 'Resubmit for approval'
        WHEN EXISTS (SELECT 1 FROM ChapterApproval c2 WHERE c2.ChapterID = c.ChapterID AND c2.Status = 1) THEN 'Pending for approval'
        WHEN NOT EXISTS (SELECT 1 FROM ChapterApproval c2 WHERE c2.ChapterID = c.ChapterID AND c2.Status <> 3) THEN 'Approved'
        ELSE 'Unknown status'
    END AS StatusMessage
FROM 
    (SELECT DISTINCT ChapterID FROM ChapterApproval) c;
