@section Scripts {
    <script>
        $(document).ready(function() {
            var courseId = @Model.FirstOrDefault()?.CourseID ?? 0; 
            var $carousel = $('#moduleCarousel');
            var lastCompletedModuleId = @Model.LastOrDefault(m => m.ModuleID <= m.LastCompletedModuleId)?.ModuleID ?? 0;

            // Initialize carousel to the next module after the last completed one
            var startIndex = Model.findIndex(m => m.ModuleID === lastCompletedModuleId) + 1;
            $carousel.carousel(startIndex);

            $('.carousel-control-next, .carousel-control-prev').click(function(e) {
                var $activeItem = $('.carousel-item.active');
                var moduleId = $activeItem.data('module-id');
                var $checkbox = $activeItem.find('.module-complete-checkbox');

                if (!$checkbox.is(':checked')) {
                    e.preventDefault(); // Prevent moving to the next module if the current one is not completed
                    alert('Please complete the current module before proceeding.');
                }
            });

            $('.module-complete-checkbox').on('change', function() {
                var $checkbox = $(this);
                var moduleId = $checkbox.data('module-id');
                if ($checkbox.is(':checked')) {
                    // Save the module completion
                    saveModuleCompletion(courseId, moduleId);
                }
            });

            function saveModuleCompletion(courseId, moduleId) {
                $.post('@Url.Action("MarkModuleComplete", "Courses")', { courseId: courseId, moduleId: moduleId }, function(response) {
                    if(!response.success) {
                        alert('Error saving module completion.');
                    }
                });
            }

            $('.finish-course').on('click', function() {
                // Finish course logic here
            });
        });
    </script>
}
