SELECT 
    l.lobname,
    COALESCE(SUM(r.billability), 0) AS total_billability
FROM 
    lob_table l
LEFT JOIN 
    allocation_details a ON l.lobid = a.lobid
LEFT JOIN 
    records r ON a.allocationid = r.allocationid
WHERE 
    DATE_FORMAT(r.from_date, '%Y-%m') = DATE_FORMAT(CURRENT_DATE(), '%Y-%m')
    AND DATE_FORMAT(r.to_date, '%Y-%m') = DATE_FORMAT(CURRENT_DATE(), '%Y-%m')
GROUP BY 
    l.lobname;
