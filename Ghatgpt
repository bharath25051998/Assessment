foreach (var response in userAnswers)
{
    var question = questions.FirstOrDefault(q => q.AssessmentQuestionID == response.AssessmentQuestionID);

    if (question != null)
    {
        // Handle single choice questions
        if (question.QuestionType == 1)
        {
            // Assuming that for single choice questions, only one option ID is selected
            var selectedOptionId = response.SelectedOptionIDs.FirstOrDefault();
            if (question.OptionText.Any(opt => opt.Id == selectedOptionId && opt.IsCorrect))
            {
                score++;
            }
        }
        // Handle multiple choice questions
        else if (question.QuestionType == 2)
        {
            var correctOptionIds = question.OptionText.Where(opt => opt.IsCorrect).Select(opt => opt.Id).ToList();
            var selectedOptionIds = response.SelectedOptionIDs;
            
            // Check if all selected options are correct and no extra incorrect options are selected
            if (selectedOptionIds.All(id => correctOptionIds.Contains(id)) &&
                correctOptionIds.All(id => selectedOptionIds.Contains(id)))
            {
                score++;
            }
        }
    }
}
