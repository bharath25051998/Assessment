let StartLogs = 
    traces
    | where timestamp >= ago(1d)
    | where message has "Running task"
    | extend 
        ServiceName = extract(@"Running task (\w+)", 1, message, typeof(string)),
        EventTime = timestamp
    | project ServiceName, EventTime
    | order by ServiceName asc, EventTime asc;

let EndLogs = 
    traces
    | where timestamp >= ago(1d)
    | where message has "Task " and message has " completed"
    | extend 
        ServiceName = extract(@"Task (\w+) completed", 1, message, typeof(string)),
        EventTime = timestamp
    | project ServiceName, EventTime
    | order by ServiceName asc, EventTime asc;

StartLogs
| join kind=leftouter (
    EndLogs
) on ServiceName
| where EndLogs_EventTime >= StartLogs_EventTime
| summarize EndTime = min(EndLogs_EventTime) by ServiceName, StartTime=StartLogs_EventTime
| order by ServiceName asc, StartTime asc
