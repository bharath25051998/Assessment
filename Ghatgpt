SELECT 
    Month_Year, 
    Bench_Count,
    Partial_Bench_Count
FROM (
    SELECT 
        CONCAT(DATENAME(MONTH, fromdate), '-', DATEPART(YEAR, fromdate)) AS Month_Year,
        SUM(CASE WHEN EmployeeEmail NOT IN (SELECT EmployeeEmail FROM #temp1) THEN 1 ELSE 0 END) AS Bench_Count,
        SUM(CASE WHEN Total_Allocation < 1 AND EmployeeEmail IN (SELECT EmployeeEmail FROM #temp1) THEN 1 ELSE 0 END) AS Partial_Bench_Count
    FROM (
        SELECT 
            CONCAT(DATENAME(MONTH, fromdate), '-', DATEPART(YEAR, fromdate)) AS Month_Year,
            EmployeeEmail,
            SUM(Allocation) AS Total_Allocation
        FROM #temp1
        GROUP BY CONCAT(DATENAME(MONTH, fromdate), '-', DATEPART(YEAR, fromdate)), EmployeeEmail
    ) AS temp
    WHERE NOT EXISTS (
        SELECT 1
        FROM PSEmployeeAdditionalDetails ad
        WHERE ad.EmployeeEmail = temp.EmployeeEmail 
        AND ad.ERD IS NOT NULL
        AND MONTH(ad.ERD) = DATEPART(MONTH, CAST(CONCAT('01-', Month_Year) AS DATE)) -- Check ERD for the same month
        AND YEAR(ad.ERD) = DATEPART(YEAR, CAST(CONCAT('01-', Month_Year) AS DATE))
    )
    GROUP BY Month_Year
) AS temp;
