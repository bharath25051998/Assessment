SELECT 
    l.lobname,
    COALESCE(SUM(IFNULL(r.billability, 0)), 0) AS total_billability
FROM 
    allocation_details a
LEFT JOIN 
    lob_table l ON a.lobid = l.lobid
LEFT JOIN 
    records r ON a.allocationid = r.allocationid
WHERE 
    (DATE_FORMAT(r.from_date, '%Y-%m') = DATE_FORMAT(CURRENT_DATE(), '%Y-%m') OR r.from_date IS NULL)
    AND (DATE_FORMAT(r.to_date, '%Y-%m') = DATE_FORMAT(CURRENT_DATE(), '%Y-%m') OR r.to_date IS NULL)
GROUP BY 
    l.lobname;
