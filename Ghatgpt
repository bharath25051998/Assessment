SELECT 
    l.lobname,
    COALESCE(SUM(CASE 
                    WHEN MONTH(r.from_date) = MONTH(CURRENT_DATE()) AND YEAR(r.from_date) = YEAR(CURRENT_DATE()) THEN r.billability 
                    WHEN MONTH(r.to_date) = MONTH(CURRENT_DATE()) AND YEAR(r.to_date) = YEAR(CURRENT_DATE()) THEN r.billability 
                    ELSE 0 
                END), 0) AS total_billability
FROM 
    lob_table l
LEFT JOIN 
    allocation_details a ON l.lobid = a.lobid
LEFT JOIN 
    records r ON a.allocationid = r.allocationid
GROUP BY 
    l.lobname;
