{
  "name": "<DataSourceName>",
  "description": "Data source for Azure Search using UAMI for authentication",
  "type": "azureblob",
  "credentials": {
    "identity": {
      "resourceId": "/subscriptions/<SubscriptionID>/resourceGroups/<ResourceGroupName>/providers/Microsoft.ManagedIdentity/userAssignedIdentities/<UAMIName>"
    }
  },
  "container": {
    "name": "<ContainerName>",
    "query": "<Optional Query>"
  }
}

- task: AzureCLI@2
  inputs:
    azureSubscription: '<Azure Service Connection Name>'
    scriptType: 'ps'
    scriptLocation: 'inlineScript'
    inlineScript: |
      # Define variables
      $resourceGroupName = "<Your Resource Group Name>"
      $searchServiceName = "<Your Search Service Name>"
      $dataSourceDefinitionFile = "definition.json"

      # Read the JSON definition
      $jsonDefinition = Get-Content -Path $dataSourceDefinitionFile -Raw

      # Call Azure Search to create the data source using UAMI
      az rest --method put `
              --uri "https://$searchServiceName.search.windows.net/datasources/<DataSourceName>?api-version=2020-06-30" `
              --headers "Content-Type=application/json" `
              --body $jsonDefinition `
              --resource "https://search.windows.net"
