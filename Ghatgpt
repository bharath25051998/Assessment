[HttpPost]
public JsonResult CalculateScore(List<UserResponse> responses)
{
    int score = 0;
    foreach (var response in responses)
    {
        var correctOptions = dbContext.Questions
            .Where(q => q.AssessmentQuestionID == response.AssessmentQuestionID)
            .SelectMany(q => q.OptionText)
            .Where(opt => opt.IsCorrect)
            .Select(opt => opt.Id)
            .ToList();

        if (response.SelectedOptionIDs.All(id => correctOptions.Contains(id)) && 
            correctOptions.Count == response.SelectedOptionIDs.Count)
        {
            score++;
        }
    }

    return Json(new { score = score });
}

public class UserResponse
{
    public int AssessmentQuestionID { get; set; }
    public List<int> SelectedOptionIDs { get; set; }
}
