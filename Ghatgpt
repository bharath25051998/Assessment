let StartLogs = 
    traces
    | where timestamp >= ago(1d)
    | where message matches regex @"Running task .+"
    | extend 
        ServiceName = extract(@"Running task (.+)", 1, message, typeof(string)),
        StartTime = timestamp
    | project ServiceName, StartTime;

let EndLogs = 
    traces
    | where timestamp >= ago(1d)
    | where message matches regex @"Task .+ completed$"
    | extend 
        ServiceName = extract(@"Task (.+) completed$", 1, message, typeof(string)),
        EndTime = timestamp
    | project ServiceName, EndTime;

StartLogs
| join kind=leftouter (
    EndLogs
) on ServiceName
| where EndTime >= StartTime
| summarize 
    StartTime = min(StartTime),
    EndTime = min(EndTime)
    by ServiceName, bin(StartTime, 1d)
| order by ServiceName asc, StartTime desc
