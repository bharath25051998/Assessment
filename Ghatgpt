trigger:
  - main  # or any other branch you want to trigger on

pool:
  vmImage: 'ubuntu-latest'  # or another agent pool

steps:
- task: AzureCLI@2
  inputs:
    azureSubscription: 'YourServiceConnection'  # Replace with your Azure service connection in ADO
    scriptType: 'bash'
    scriptLocation: 'inlineScript'
    inlineScript: |
      # Variables
      resourceGroupName="YourResourceGroupName"
      privateEndpointName="YourPrivateEndpointName"
      sqlServerName="YourSqlServerName"
      vnetName="YourVirtualNetworkName"
      subnetName="YourSubnetName"
      location="YourRegion" # Example: eastus

      # Create the private endpoint
      az network private-endpoint create \
        --name $privateEndpointName \
        --resource-group $resourceGroupName \
        --vnet-name $vnetName \
        --subnet $subnetName \
        --private-connection-resource-id "/subscriptions/YourSubscriptionId/resourceGroups/$resourceGroupName/providers/Microsoft.Sql/servers/$sqlServerName" \
        --group-id sqlServer \
        --connection-name "sqlserver-private-endpoint" \
        --location $location

      # Approve the private endpoint connection
      az sql server private-endpoint-connection approve \
        --name $privateEndpointName \
        --resource-group $resourceGroupName \
        --server $sqlServerName \
        --description "Auto-approval via ADO pipeline"
