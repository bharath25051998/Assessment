@section Scripts {
    <script>
        $(document).ready(function() {
            var courseId = @Model.FirstOrDefault()?.CourseID ?? 0; 
            var $carousel = $('#moduleCarousel');
            var lastCompletedModuleId = @Model.LastOrDefault(m => m.ModuleID <= m.LastCompletedModuleId)?.ModuleID ?? 0;

            // Initialize carousel to the module where the user left off
            var startIndex = Model.findIndex(m => m.ModuleID === lastCompletedModuleId);
            startIndex = startIndex >= 0 ? startIndex + 1 : 0; // Start from the next module after the last completed one
            $carousel.carousel(startIndex);

            $('.carousel-control-next').click(function(e) {
                var $activeItem = $('.carousel-item.active');
                var $checkbox = $activeItem.find('.module-complete-checkbox');
                var isCompleted = $checkbox.is(':checked') || $checkbox.is(':disabled');

                if (!isCompleted) {
                    e.preventDefault(); // Prevent moving to the next module
                    alert('Please complete the current module before proceeding.');
                } else {
                    var moduleId = $activeItem.data('module-id');
                    if (!$checkbox.is(':disabled')) {
                        // Save the module completion
                        saveModuleCompletion(courseId, moduleId);
                    }
                }
            });

            function saveModuleCompletion(courseId, moduleId) {
                $.post('@Url.Action("MarkModuleComplete", "Courses")', { courseId: courseId, moduleId: moduleId }, function(response) {
                    if(!response.success) {
                        alert('Error saving module completion.');
                    }
                });
            }

            $('.finish-course').on('click', function() {
                // Finish course logic here
            });
        });
    </script>
}
